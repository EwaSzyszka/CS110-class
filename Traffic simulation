import numpy as np
from random import randint

class Trafficsimulation:

    def __init__(self, road_length, density, max_velo, prob_slow_down):

        self.road_length = road_length
        self.density = density
        self.max_velo = max_velo
        self.prob_slow_down = prob_slow_down
        self.lists = [None] * road_length

    def assignStates(self):
        for i in range(self.density):
            self.lists[i] = randint(0, self.max_velo)
        np.random.shuffle(self.lists) #put the new values in random positions
        return self.lists
    
    def updateRule(self):
        
        distances = []
        for i in range(len(self.lists)):
            if self.lists[i] != None:
                count = i + 1
                while self.lists[count % self.road_length]== None:
                    count +=1
                distance = (count - i)-1
            else:
                distance = None
            distances.append(distance)
        print ("Initial velocities", self.lists)
        print ("Distances",distances)
        
        
        new_velocity = []
        for i in range(len(distances)):
              
            if distances[i]== None:
                new_velocity.append(-1) #corr
            if distances[i]==0:
                new_velocity.append(0) #corr
            if distances[i]> self.lists[i]:
                new_velocity.append(self.lists[i]+1)
            if distances[i]<self.lists[i] and distances[i]!= None or 0:                
                new_velocity.append(int(self.lists[i])- int(distances[i]))   
            if distances[i] == self.lists[i] and distances[i]!= None or 0:
                new_velocity.append(self.lists[i])
    
        print ("New velocities", new_velocity) 
        
        next_step = [-1]*len(new_velocity) 
        for i in range(len(new_velocity)):

            if new_velocity[i] != -1:
                next_step[(new_velocity[i]+ i)%len(new_velocity)]  = new_velocity[i]
            
        print ("Next step", next_step)
        print (''.join('.' if x == -1  else str(x)  for x  in next_step))
          
        

sim1 = Trafficsimulation(10,2,5,0.5)

sim1.assignStates()
sim1.updateRule()
